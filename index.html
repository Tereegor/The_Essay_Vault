<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сочинения по литературным произведениям</title>
</head>
<body>
<header>
    <h1>Сочинения по литературным произведениям</h1>
    <p>Найдите лучшие сочинения прямо сейчас</p>
</header>

<div class="search-bar">
    <input type="text" id="search-input" placeholder="Введите название произведения">
    <button onclick="searchEssays()">Найти</button>
    <button class="reset-btn" onclick="resetSearch()">Сбросить</button>
</div>

<div class="counter" id="counter"></div>

<div id="results">
    <h2>Результаты поиска</h2>
    <div id="results-container"></div>
</div>

<script>
    const files = [
        "война_и_мир.txt",
        "преступление_и_наказание.txt",
        "евгений_онегин.txt"
    ];
    const baseURL = "https://raw.githubusercontent.com/Tereegor/The_Essay_Vault/main/pages/";
    const essays = {};
    const resultsContainer = document.getElementById("results-container");
    const counterElement = document.getElementById("counter");

    async function loadEssays() {
        for (const file of files) {
            const fileURL = baseURL + file;
            try {
                const response = await fetch(fileURL);
                if (response.ok) {
                    const text = await response.text();
                    essays[file] = text;
                }
            } catch (error) {
                console.error("Ошибка загрузки файла:", file);
            }
        }
    }

    function searchEssays() {
        const query = document.getElementById("search-input").value.toLowerCase();
        resultsContainer.innerHTML = "";
        let found = 0;

        Object.entries(essays).forEach(([title, content]) => {
            const normalizedTitle = title.toLowerCase().replace(/_/g, " ").replace(".txt", "");

            if (normalizedTitle.includes(query)) {
                found++;
                const highlightedTitle = normalizedTitle.replace(
                    new RegExp(query, "gi"),
                    (match) => `<span>${match}</span>`
                );

                const resultDiv = document.createElement("div");
                resultDiv.className = "essay";
                resultDiv.innerHTML = `
                    <h2>${highlightedTitle}</h2>
                    <pre>${content.substring(0, 300)}...</pre>
                `;
                resultsContainer.appendChild(resultDiv);
            }
        });

        counterElement.textContent = found
            ? `Найдено результатов: ${found}`
            : "Ничего не найдено.";
    }

    function resetSearch() {
        document.getElementById("search-input").value = "";
        resultsContainer.innerHTML = "";
        counterElement.textContent = "";
    }

    loadEssays();
</script>

</body>
</html>
